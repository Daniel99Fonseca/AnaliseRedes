---
title: "Relatório Analise Redes"
output:
  pdf_document:
    latex_engine: xelatex
date: "2025-11-20"
---

```{r setup, include=FALSE}
source("AR_ParteI.R")
knitr::opts_chunk$set(echo=FALSE)
```

# Parte I

### Contextualização da rede

A rede apresentada é relativa a contactos entre pessoas numa festa, sendo que os nodos representam pessoas e as ligações interações entre as pessoas presentes na festa. Ao longo deste capítulo, abordaremos a rede como **Rede Festa**.

### Análise da Rede da festa

**a) Indique a dimensão e o número de ligações da rede. Determine a densidade e classifique a rede.**

A rede demonstra as interações entre **`r n_nod_festa` pessoas** (número de nodos). No total, foram registadas **`r n_lig_festa` interações**, o que indica que a festa foi movimentada, com várias interações entre os participantes da festa, dado que a densidade da rede tem um valor de `r round(densidade_festa,3)` , ou seja, foram registadas **`r round(densidade_festa * 100, 1)`%** das possíveis interações entre os 113 convidados. Por conseguinte, dado o contexto da rede (social), consideramos a rede como relativamente esparsa.

```{r echo=FALSE, fig.width=4, fig.height=4, fig.cap="Fig.1 - Rede da Festa"}
plot(g_festa, vertex.size=8, vertex.label=NA, edge.color="grey80")
```

**b) Obtenha o grau médio e a distribuição de grau.** **Caracterize a distribuição de grau (mediana, quartis, etc.) e comente.** **Calcule o parâmetro de heterogeneidade.** **Indique o que pode concluir quanto à existência de hubs.**

-   **Grau Médio**: `r media_festa`
-   **Mediana** : `r median_festa`
-   **Mínimo** : `r min_festa`
-   **Máximo** : `r max_festa`
-   **1o Quartil** : `r q1_festa`
-   **3o Quartil** : `r q3_festa`
-   **Heterogeneidade** : `r heterogeneity_festa`

```{r echo=FALSE, fig.width=4, fig.height=4, fig.cap="Fig.2 - Distribuição dos graus"}
# Histograma
hist(graus_festa, breaks = 20, col = "lightblue",
main = "Distribuição de Grau na Festa",
xlab = "Número de Interações",
ylab = "Frequência")

# Linhas da média e mediana
abline(v = mean(graus_festa), col = "red", lwd = 2)
abline(v = median(graus_festa), col = "blue", lwd = 2)

# Legenda
legend("topright", legend = c("Média", "Mediana"),
col = c("red", "blue"), lwd = 2)
```

Através das estatísticas da distribuição de grau na Rede Festa, inferimos que a pessoa típica, interagiu com **`r median_festa`** pessoas, o que representa uma festa bastante social.

Como a **mediana é menor que a média**, e vísivel na Figura 1, a distribuição é assimétrica à direita, o que indica que algumas pessoas interagiram com mais participantes do que o normal.

```{r echo=FALSE, fig.width=4, fig.height=4, fig.cap="Fig.3 - Boxplot Rede da Festa"}
boxplot(degree(g_festa), horizontal=TRUE)
```

Também inferimos que a maioria das pessoas (intervalo entre Q1 e Q3), teve entre **`r q1_festa`** a **`r q3_festa`** interações.


Há valores elevados, sendo o máximo `r max_festa` interações, ou seja, alguém interagiu com quase todos os participantes, logo é um candidato para a *hub*. Em contraste, alguém esteve isolado na festa, com apenas `r min_festa` interação.

Relativamente à heterogeneidade, com o valor de **`r heterogeneity_festa`**, é considerada heterogénea, o que, em confluência com a Figura 1, inferimos que há alguma variância nas interações registadas, e, devido à distribuição assimétrica à direita, concluímos que existem hubs, por ex, a pessoa com `r max_festa` interações é claramente um hub.

**c) Estude a associação de grau e indique o que poderá concluir-se.**

A associação de grau é uma medida que permite avaliar se existe uma correlação entre os graus dos nodos - participantes da festa. É coeficiente que varia de -1 a 1.

- Valor positivo indica que nodos com grau alto tendem a ligar-se a outros nodos de grau alto. 
- Valor negativo indica que nodos com grau alto tendem a ligar-se a nodos de grau baixo.
- E um valor igual a 0 indica que não há nenhuma correlação.

```{r echo=FALSE, fig.width=4, fig.height=4, fig.cap="Fig.4 - Grau do nó vs Grau médio dos vizinhos"}
knn_nodos <- knn(g_festa, vids=V(g_festa))$knn
plot(graus_festa, knn_nodos, pch=20,
     xlab="Grau do nodo", ylab="Grau médio dos vizinhos")
abline(lm(knn_nodos ~ graus_festa), col="red")
```
A figura 4 permite perceber se as pessoas com mais interações (ligações) tendem a interagir com outras igualmente populares ou com pessoas menos conectadas.

A inclinação da linha vermelha indica a assortatividade de grau da rede. A assortatividade ligeiramente negativa (**-0.12**) que houve uma tendência: pessoas muito sociáveis tenderam a interagir com pessoas menos sociáveis. 

```{r echo=FALSE, warning=FALSE}
library(knitr)
library(kableExtra)

df <- data.frame(
  no = nos_grau1,
  grau = graus_festa[nos_grau1],
  knn = knn_vals[nos_grau1]
)

kable(df, format = "latex", booktabs = TRUE, caption = "Nodos com grau 1 e respetivo kNN") %>%
  kable_styling(latex_options = c("hold_position"))
```

**d) Determine a média dos comprimentos dos caminhos mais curtos. Indique o que pode concluir-se quanto à distância média.**

A média dos comprimentos dos caminhos mais curtos na rede foi: **`r round(mean_dist_festa, 3)`**.

Este valor indica o **número médio de passos necessários para que uma pessoa possa chegar a outra através de uma cadeia de interações**.

No contexto da festa, isto significa que, em média, qualquer pessoa está a apenas cerca de **`r round(mean_dist_festa, 3)`** interações de outra pessoa. Isto sugere que a rede apresenta um comportamento típico de **small-world**: mesmo com mais de cem participantes, a distância média entre duas pessoas é relativamente reduzida, dado que a teoria de "6 passos de separação" sugere que qualquer pessoa está a, no máximo, 6 interações/conexões de qualquer outra pessoa no planeta. Assim, na festa, em teoria, se quiseremos interagir com o indivíduo X, estamos a `r round(mean_dist_festa, 3)` dele!

**e) Determine os coeficientes de clustering dos nodos e da rede. Diga o que pode concluir-se quanto à existência de triângulos.** O coeficiente de **clustering local** mede quanto os amigos de uma pessoa também são amigos entre si, ou no contexto da rede, se eu interagi com o indíviduos X e Y, o clustering local verifica se X e Y também interagiram um com o outro. Se sim, forma-se um triângulo entre "eu, X e Y". O **clustering global**, da rede, avalia se a festa teve muitos grupos de 3 pessoas completamente conetados.

Desta forma, a Rede da Festa, teve um clustering local de **`r mean(clust_local_festa)`**, o que é considerado bastante elevado para uma rede social, revelando como os participantes agiram na festa: em grupos coesos, com muitas interações dentro de pequenos círculos sociais, por exemplo amigos que vieram juntos, colegas de trabalho, conhecidos antes da festa.

Avaliando o **clustering local**, observamos alguns nodos com valores acima de **0.70** e até **0.89**, reforçando a ideia de que houve pessoas pertencentes a grupos sociais muito fechados.

**f) Efetue a decomposição de core da rede. Indique o número de conchas existentes e a dimensão de cada uma. Indique o que poderá concluir-se.**

O **core da rede** ajuda a identificar núcleos densamente conectados dentro de uma rede. O **k-core** de uma rede é um subgrafo que cada nodo tem pelo menos **k ligações** dentro desse subgrafo. No contexto da rede, um k=3 (3-core), só inclui as pessoas que têm **pelo menos** 3 interações dentro desse subgrupo.

O core da rede corresponde ao k-core de maior ordem, ou seja, à concha com o maior valor de k: **28-core**. Este núcleo contém **60 nodos**, todos com pelo menos **28 ligações** internas no subgrafo correspondente, indicando que a rede tem um núcleo muito denso e conectado.


```{r core28_plot, fig.width=4, fig.height=4, fig.cap="Fig. 5 - 28-core da Rede da Festa"}

# Seleciona nodos do 28-core
core28_nodes <- V(g_festa)[core == 28]

# Define cores: 28-core em vermelho, restantes em azul claro
V(g_festa)$color <- ifelse(V(g_festa) %in% core28_nodes, "red", "lightblue")

# Layout fixo (para evitar problemas de tamanho)
lay <- layout_with_fr(g_festa)

# Plot
plot(g_festa,
     layout = lay,
     vertex.size = 6,
     vertex.label = NA,
     main = "Rede da festa com 28-core destacado")
```

Relativamente ao **número de conchas**, existem **`r num_conchas`**:

```{r echo=FALSE}
library(knitr)
kcores <- names(dim_conchas)
counts <- as.character(as.numeric(dim_conchas))

tabela <- rbind(
c("k-core", kcores),
c("Número de nodos", counts)
)

kable(tabela, caption = "Distribuição de k-cores na rede", align = "c")
```

Interessante que, se "salta" do k-core 1 diretamente o k-core 11. Na Rede da Festa não existe nenhum conjunto de nodos que possam formar um subgrafo onde todos tenham grau ≥ 2. Por isso, não existe 2-core, 3-core, etc.

Concluímos que a rede é bastante densa no seu centro, dado haverem 60 nodos com 28 ligações.
Existe uma estrutura _core periphery_, com um núcleo denso e uma periferia menos conetada, 1-core, 11-core, etc. que se liga ao núcleo mas não é tão interligada internamente.
Existe uma variação devido às 17 conchas, o que remete para a heterogeneidade da rede.

Os 60 nodos do _core_ são os mais influentes em termos de interações. Assim, remover ou isolar o núcleo pode fragmentar significativamente a rede, enquanto remover nodos da periferia teria menos impacto.

**g) Elabore um pequeno texto com comentários adicionais que considere pertinentes.**
A rede analisada apresenta uma estrutura heterogénea, com uma densidade relativamente elevada (**~35%**) e uma média de grau de aproximadamente 39 ligações por nó. A distribuição de grau revela que a maioria dos indivíduos está moderadamente conectada, mas existem nós com grau muito elevado, sugerindo a presença de alguns hubs.

A heterogeneidade ligeira sugere que, embora existam hubs, a maioria dos indivíduos participa de forma equilibrada nas interações, o que indica uma certa igualdade na participação social.

O coeficiente de clustering global (~0,50) e os valores de clustering local demonstram a presença de numerosos triângulos, refletindo que amigos de um mesmo indivíduo tendem a conhecer-se entre si.

A estrutura da rede é propícia a formar “pequenos mundos”: nodos periféricos conseguem aceder rapidamente ao _core_ - através de poucos passos - favorecendo dinâmicas sociais.

```{r echo=FALSE, fig.width=6, fig.height=4, fig.cap="Fig. 6 - Comunidades da Rede da Festa"}
lc <- cluster_louvain(g_festa)
# Escolher comunidades com mais de 10 nós
com_grandes <- which(table(membership(lc)) > 10)
subg <- induced_subgraph(g_festa, which(membership(lc) %in% com_grandes))
plot(lc, g_festa, vertex.size = ifelse(names(V(g_festa)) %in% top_hubs, 15, 7),
     vertex.label=NA, vertex.color=membership_lc,edge.color = rgb(0,0,0,0.1))

```

Na Figura X - Gráfico de Louvain - é possível observar as comunidades. 
Cada cor representa uma comunidade detetada pelo algoritmo Louvain, sendo que os nós de cada comunidade estão mais conetados entre si. Por sua vez, os nós mais próximos uns dos outros tendem a ter mais ligações entre si. Os nós mais próximos das fronteiras de cada comunidade são considerados 'nós-pontes' dado facilitarem as interações entre diversas comunidades. 
Desta forma, é possível observar, de forma visual, o que fora abordado até agora, os hubs, os nós centrais e os grupos mais coesos.

Em suma, trata-se de uma rede social relativamente densa e estruturada, com núcleos centrais influentes e uma periferia mais dispersa, permitindo identificar os indivíduos mais centrais e os padrões de ligação predominantes.


**h) Tendo em conta o contexto, identifique algumas características/o papel de alguns dos presentes na festa. Justifique.** 

Pessoas com muitas interações (grau elevado) são os mais sociáveis e/ou populares na festa, servindo como hubs de interação, conectando várias pessoas que, de outra forma, poderiam não interagir, assim como quem pertence ao _28-core_ - núcleo mais interno - desempenha um papel central na coesão do grupo, sendo considerados **'a alma da festa'**.

A _**betweenness**_ mede quantas vezes um nó está no caminho mais curto entre outros dois nós.
Pessoas com _betweenness_ alta são consideradas pontes, intermediários, ligam grupos diferentes, e com _betweeness_ baixa, estão integradas num grupo, mas não ligam grupos entre si.

```{r echo=FALSE, fig.width=4, fig.height=4, fig.cap="Fig. 7 - Os 10 nós com mais intermediação"}
top10 <- sort(bet, decreasing = TRUE)[1:10]

ids <- names(top10)

barplot(
  top10,
  names.arg = ids,
  col = "orange",
  main = "Top 10 pessoas com maior betweenness",
  ylab = "Betweenness",
  xlab = "Número do Nó"
)
```
Assim, de acordo com a Figura X, podemos identificar o Nó 30 como o que interagiu com mais grupos diversos, facilitando as interações entre pessoas diversas.

```{r echo=FALSE, fig.width=4, fig.height=4, fig.cap="Fig. 8 - O nó mais central"}
# Criar cores para os nós
cores <- rep("lightblue", vcount(g_festa))
cores[nodo_top] <- "red"  # destaca o nó mais central

# Criar tamanhos proporcionais ao betweenness
tamanhos <- 5 + 10 * (bet / max(bet))  # escala para visualização

# Plot da rede
plot(g_festa,
     vertex.color = cores,
     vertex.size = tamanhos*1.3,
     vertex.label = NA,
     main = "Rede da festa (nó com maior betweenness em vermelho)")
```

**Participantes periféricos** (de grau baixo e conchas pequenas) têm poucas ligações e podem representar pessoas menos integradas e/ou mais introvertidas, interagindo apenas com pequenos subgrupos.

Já os **núcleos intermediários**, podem ser grupos de amigos próximos ou cliques, que interagem entre si e, em alguns casos, ligam-se ao núcleo central.

Nodos com **clustering local** elevado - indivíduos cujos vizinhos estão muito conectados entre si - podem desempenhar o papel de 'intermediadores', mantendo pequenas “bolhas” de interação dentro da festa vivas.

O **nodo** com o maior grau é considerado o mais social devido ao elevado número de interações, podendo ter o papel de organizador da festa ou - se tal for o caso - o aniversariante.


# Parte II - Q1


### Contextualização

Foi nos pedida a criação de uma rede aleatória através do *Igraph*, na qual devem existir 500 nodos e cerca de 1000 ligações.

```{r fig_rede_q1, fig.width=8, fig.height=8, echo=FALSE}
# Modelo Preferential-Attachment
# 500 nodos, ~1000 ligações
set.seed(5158)

rede_q1 <- sample_pa(n = 500, power = 1, m = 2, directed = FALSE)

plot(rede_q1, vertex.size = 5, vertex.label = NA, edge.color = "grey")
```

**Figura 2** Rede Aleatória, Modelo Preferential-Attachment

**I) Detemine a densidade e classifique a rede;**

A densidade da rede aleatória criada é de **`r round(densidade_pa, 3)`**, isto é, dentro desta rede apenas existem **`r round(densidade_pa * 100, 3)`%** das ligações possíveis.

Como a densidade da rede é muito próxima de 0, a rede é classificada como **rede muito esparsa**.

**II) Indique se a rede é conexa;**

Uma rede é conexa se apartir de qualquer nodo na rede seja possível chegar todos os outros nodos da rede, e como este é o caso para a rede criada, logo podemos dizer que a rede é conexa.

**III) Obtenha o grau médio e a distribuição de grau. Caracterize a distribuição de grau (mediana, quartis, etc.) e comente;**

O grau médio da rede é de **`r round(mean(graus_q1), 2)`**, ou seja, em média cada nodo possui cerca de **`r round(mean(graus_q1), 0)`** ligações.

A distribuição de grau mostra valores entre **`r min(graus_q1)`** e **`r max(graus_q1)`**, com quartis **Q1=`r quantile(graus_q1, probs = 0.25)`**, **Q2/Mediana=`r median(graus_q1)`** e **Q3=`r quantile(graus_q1, probs = 0.75)`**, o que indica que a maioria dos nodos possui entre `r round(quantile(graus_q1, probs = 0.25))` e `r round(quantile(graus_q1, probs = 0.75))` ligações.

**IV) Calcule o parâmetro de heterogeneidade. Indique o que pode concluir quanto à existência de hubs;**

**V) Estude a associação de grau e indique o que poderá concluir-se;**

**VI) Determine a média dos comprimentos dos caminhos mais curtos e o diâmetro da rede. Indique o que pode concluir-se quanto à distância média;**

**VII) Determine os coeficientes de clustering da rede. Diga o que pode concluir-se quanto à existência de triângulos.**


# Parte II - Q2

**I) Indique o número de ligações removidas;**

Após a remoção do nodos selecionados aleatóriamente pudémos verificar uma redução de **`r rem_nod`** na nova rede.

**II) Determine a densidade e classifique a rede;**

**III) Indique se a rede é conexa;**

Uma rede é conexa se apartir de qualquer nodo na rede seja possível chegar todos os outros nodos da rede. Devido à remoção dos nodos e consequentemente a perda de **`r rem_nod`** ligações, a nova rede deixou de ser conexa, pois um nodo perdeu todas a ligações ficando isolado da rede.

**IV) Obtenha o grau médio e a distribuição de grau. Caracterize a distribuição de grau (mediana, quartis, etc.) e comente;**

**V) Calcule o parâmetro de heterogeneidade. Indique o que pode concluir quanto à existência de hubs;**

**VI) Estude a associação de grau e indique o que poderá concluir-se;**

**VII) Determine a média dos comprimentos dos caminhos mais curtos e o diâmetro da rede. Indique o que pode concluir-se quanto à distância média;**

**VIII) Determine o coeficiente de clustering da rede. Diga o que pode concluir-se quanto à existência de triângulos;**

**IX)  Compare os resultados obtidos antes e após a remoção de ligações.**
