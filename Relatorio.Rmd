---
title: "null"
output:
  pdf_document:
    latex_engine: xelatex
  word_document: default
date: "null"
---

```{r setup, include=FALSE}
source("AR_ParteI.R")
knitr::opts_chunk$set(echo=FALSE)
```

# Parte I

## Contextualização da rede

A rede apresentada é relativa a contactos entre pessoas numa festa, sendo que os nodos representam pessoas e as ligações interações entre as pessoas presentes na festa. Ao longo deste capítulo, abordaremos a rede como **Rede Festa**.


## Análise da Rede da festa


**a) Indique a dimensão e o número de ligações da rede. Determine a densidade e classifique a rede.**

A rede demonstra as interações entre **`r n_nod_festa` pessoas** (número de nodos). No total, foram registadas **`r n_lig_festa` interações**, o que indica que a festa foi movimentada, com várias interações entre os participantes da festa, dado que a densidade da rede tem um valor de `r round(densidade_festa,3)` , ou seja, foram registadas **`r round(densidade_festa * 100, 1)`%** das possíveis interações entre os 113 convidados. Por conseguinte, dado o contexto da rede (social), consideramos a rede como relativamente esparsa.

```{r echo=FALSE, fig.width=6, fig.height=5, fig.cap="Rede da Festa", fig.align='center', fig.pos='H'}

layout_graphopt <- layout_with_graphopt(
  g_festa,
  niter = 1000,
  charge = 0.5,
  spring.length = 150,
)

plot(
  g_festa,
  layout = layout_graphopt,
  vertex.size = 8,
  edge.width = 0.5,
  vertex.label = NA,
  edge.color = "grey80",
  vertex.frame.color = "black",
  main = "Rede da Festa"
)
```



**b) Obtenha o grau médio e a distribuição de grau.** **Caracterize a distribuição de grau (mediana, quartis, etc.) e comente.** **Calcule o parâmetro de heterogeneidade.** **Indique o que pode concluir quanto à existência de hubs.**

-   **Grau Médio**: `r media_festa`
-   **Mediana** : `r median_festa`
-   **Mínimo** : `r min_festa`
-   **Máximo** : `r max_festa`
-   **1º Quartil** : `r q1_festa`
-   **3º Quartil** : `r q3_festa`
-   **Heterogeneidade** : `r heterogeneity_festa`

```{r echo=FALSE, fig.width=6, fig.height=4, fig.cap="Distribuição dos graus", fig.pos='H', fig.align='center'}

hist(graus_festa, breaks = 20, col = "lightblue",
     main = "Distribuição de Grau na Festa",
     xlab = "Número de Interações",
     ylab = "Frequência")

abline(v = mean(graus_festa), col = "red", lwd = 2)
abline(v = median(graus_festa), col = "blue", lwd = 2)

legend("topright", legend = c("Média", "Mediana"), col = c("red", "blue"), lwd = 2)
```

Através das estatísticas da distribuição de grau na Rede Festa, inferimos que a pessoa típica, interagiu com **`r median_festa`** pessoas, o que representa uma festa bastante social.

Como a **mediana é menor que a média**, e vísivel na Figura 1, a distribuição é assimétrica à direita, o que indica que algumas pessoas interagiram com mais participantes do que o normal.

```{r echo=FALSE, fig.width=6, fig.height=3.5, fig.cap="Boxplot da distribuição de graus na Festa", fig.pos='H', fig.align='center'}

# Reduz margens
par(mar = c(5, 4, 4, 2) + 0.1)

boxplot(graus_festa,
        horizontal = TRUE,
        col = "lightblue",
        border = "darkblue",
        main = "Boxplot da Distribuição de Graus na Festa",
        xlab = "Número de Interações",
        ylab = "",
        las = 1,
        outcol = "red")

abline(v = median_festa, col = "red", lwd = 2, lty = 2)

legend("topright", legend = paste("Mediana =", median_festa),
       col = "red", lwd = 2, lty = 2, bty = "n")

grid(nx = NULL, ny = NA, col = "gray90", lty = "dotted")
```

Também inferimos que a maioria das pessoas (intervalo entre Q1 e Q3), teve entre **`r q1_festa`** a **`r q3_festa`** interações.

Há valores elevados, sendo o máximo `r max_festa` interações, ou seja, alguém interagiu com quase todos os participantes, logo é um candidato para a *hub*. Em contraste, alguém esteve isolado na festa, com apenas `r min_festa` interação.

Relativamente à heterogeneidade, com o valor de **`r round(heterogeneity_festa,3)`**, é considerada heterogénea, o que, em confluência com a Figura 1, inferimos que há alguma variância nas interações registadas, e, devido à distribuição assimétrica à direita, concluímos que existem hubs, por ex, a pessoa com `r max_festa` interações é claramente um hub.



**c) Estude a associação de grau e indique o que poderá concluir-se.**

A associação de grau é uma medida que permite avaliar se existe uma correlação entre os graus dos nodos - participantes da festa. É coeficiente que varia de -1 a 1.

- Valor positivo indica que nodos com grau alto tendem a ligar-se a outros nodos de grau alto. 
- Valor negativo indica que nodos com grau alto tendem a ligar-se a nodos de grau baixo.
- E um valor igual a 0 indica que não há nenhuma correlação.

```{r echo=FALSE, fig.width=6, fig.height=4, fig.cap="Grau do nó vs Grau médio dos vizinhos", fig.pos='H', fig.align='center'}

# Gráfico
plot(graus_festa,
     knn_vals, 
     pch=19,
     cex=1.2,              # tamanho dos pontos
     col=rgb(0,0,1,0.6),   # azul
     xlab="Grau do nodo", 
     ylab="Grau médio dos vizinhos",
     main="Grau do nodo vs Grau médio dos vizinhos")

abline(lm(knn_vals ~ graus_festa), col="red", lwd=2)

legend("topright", legend="Regressão Linear", col="red", lwd=2, bty="n")
grid()
```

A figura 4 permite perceber se as pessoas com mais interações (ligações) tendem a interagir com outras igualmente populares ou com pessoas menos conectadas.

A inclinação da linha vermelha indica a assortatividade de grau da rede. A assortatividade ligeiramente negativa (**-0.12**) que houve uma tendência: pessoas muito sociáveis tenderam a interagir com pessoas menos sociáveis. 

```{r echo=FALSE, warning=FALSE, fig.pos='H', fig.align='center'}
library(knitr)
library(kableExtra)

df <- data.frame(
  no = nos_grau1,
  grau = graus_festa[nos_grau1],
  knn = knn_vals[nos_grau1]
)

kable(df, format = "latex", booktabs = TRUE, caption = "Nodos com grau 1 e respetivo kNN") %>%
  kable_styling(latex_options = c("hold_position"))
```

**d) Determine a média dos comprimentos dos caminhos mais curtos. Indique o que pode concluir-se quanto à distância média.**

A média dos comprimentos dos caminhos mais curtos na rede foi: **`r round(mean_dist_festa, 3)`**.

Este valor indica o **número médio de passos necessários para que uma pessoa possa chegar a outra através de uma cadeia de interações**.

No contexto da festa, isto significa que, em média, qualquer pessoa está a apenas cerca de **`r round(mean_dist_festa, 3)`** interações de outra pessoa. Isto sugere que a rede apresenta um comportamento típico de **small-world**: mesmo com mais de cem participantes, a distância média entre duas pessoas é relativamente reduzida, dado que a teoria de "6 passos de separação" sugere que qualquer pessoa está a, no máximo, 6 interações/conexões de qualquer outra pessoa no planeta. Assim, na festa, em teoria, se quiseremos interagir com o indivíduo X, estamos a `r round(mean_dist_festa, 3)` dele!

**e) Determine os coeficientes de clustering dos nodos e da rede. Diga o que pode concluir-se quanto à existência de triângulos.** O coeficiente de **clustering local** mede quanto os amigos de uma pessoa também são amigos entre si, ou no contexto da rede, se eu interagi com o indíviduos X e Y, o clustering local verifica se X e Y também interagiram um com o outro. Se sim, forma-se um triângulo entre "eu, X e Y". O **clustering global**, da rede, avalia se a festa teve muitos grupos de 3 pessoas completamente conetados.

Desta forma, a Rede da Festa, teve um clustering local de **`r mean(clust_local_festa)`**, o que é considerado bastante elevado para uma rede social, revelando como os participantes agiram na festa: em grupos coesos, com muitas interações dentro de pequenos círculos sociais, por exemplo amigos que vieram juntos, colegas de trabalho, conhecidos antes da festa.

Avaliando o **clustering local**, observamos alguns nodos com valores acima de **0.70** e até **0.89**, reforçando a ideia de que houve pessoas pertencentes a grupos sociais muito fechados.

**f) Efetue a decomposição de core da rede. Indique o número de conchas existentes e a dimensão de cada uma. Indique o que poderá concluir-se.**

O **core da rede** ajuda a identificar núcleos densamente conectados dentro de uma rede. O **k-core** de uma rede é um subgrafo que cada nodo tem pelo menos **k ligações** dentro desse subgrafo. No contexto da rede, um k=3 (3-core), só inclui as pessoas que têm **pelo menos** 3 interações dentro desse subgrupo.

O core da rede corresponde ao k-core de maior ordem, ou seja, à concha com o maior valor de k: **28-core**. Este núcleo contém **60 nodos**, todos com pelo menos **28 ligações** internas no subgrafo correspondente, indicando que a rede tem um núcleo muito denso e conectado.


```{r core28_plot, fig.width=7, fig.height=5, fig.cap="28-core da Rede da Festa", fig.pos='H', fig.align='center'}

# Nodos do 28-core
core28_nodes <- V(g_festa)[core == 28]

# cores: 28-core em vermelho, remanescente em azul claro
V(g_festa)$color <- ifelse(V(g_festa) %in% core28_nodes, "red", "lightblue")

# A tentar afastar os nodos
lay <- layout_with_fr(g_festa, niter = 1000)

plot(g_festa,
     layout = lay,
     vertex.size = 7,
     vertex.label = NA,
     vertex.frame.color = "black",
     main = "28-core Rede da Festa")
```

Relativamente ao **número de conchas**, existem **`r num_conchas`**:

```{r echo=FALSE, fig.pos='H'}

kcores <- names(dim_conchas)
counts <- as.character(as.numeric(dim_conchas))

tabela <- rbind(
c("k-core", kcores),
c("Nº de nodos", counts)
)

kable(tabela, caption = "Distribuição de k-cores na rede", align = "c")
```

Interessante que, se "salta" do k-core 1 diretamente o k-core 11. Na Rede da Festa não existe nenhum conjunto de nodos que possam formar um subgrafo onde todos tenham grau ≥ 2. Por isso, não existe 2-core, 3-core, etc.

Concluímos que a rede é bastante densa no seu centro, dado haverem 60 nodos com 28 ligações.
Existe uma estrutura _core periphery_, com um núcleo denso e uma periferia menos conetada, 1-core, 11-core, etc. que se liga ao núcleo mas não é tão interligada internamente.
Existe uma variação devido às 17 conchas, o que remete para a heterogeneidade da rede.

Os 60 nodos do _core_ são os mais influentes em termos de interações. Assim, remover ou isolar o núcleo pode fragmentar significativamente a rede, enquanto remover nodos da periferia teria menos impacto.

**g) Elabore um pequeno texto com comentários adicionais que considere pertinentes.**
A rede analisada apresenta uma estrutura heterogénea, com uma densidade relativamente elevada (**~35%**) e uma média de grau de aproximadamente 39 ligações por nó. A distribuição de grau revela que a maioria dos indivíduos está moderadamente conectada, mas existem nós com grau muito elevado, sugerindo a presença de alguns hubs.

A heterogeneidade ligeira sugere que, embora existam hubs, a maioria dos indivíduos participa de forma equilibrada nas interações, o que indica uma certa igualdade na participação social.

O coeficiente de clustering global (~0,50) e os valores de clustering local demonstram a presença de numerosos triângulos, refletindo que amigos de um mesmo indivíduo tendem a conhecer-se entre si.

A estrutura da rede é propícia a formar “pequenos mundos”: nodos periféricos conseguem aceder rapidamente ao _core_ - através de poucos passos - favorecendo dinâmicas sociais.

```{r echo=FALSE, fig.width=6, fig.height=4, fig.cap="Comunidades da Rede da Festa", fig.pos='H', fig.align='center'}

# Comunidades
lc <- cluster_louvain(g_festa)

# Comunidades com mais de 10 nós
com_grandes <- which(table(membership(lc)) > 10)
subg <- induced_subgraph(g_festa, which(membership(lc) %in% com_grandes))

lay <- layout_with_fr(g_festa, niter=1000)

# Plot
plot(lc, g_festa,
     layout = lay,
     vertex.size = ifelse(names(V(g_festa)) %in% top_hubs, 15, 7),
     vertex.label = NA,
     vertex.color = membership_lc,
     vertex.frame.color = "black",
     edge.color = rgb(0,0,0,0.1),
     main = "Comunidades da Rede da Festa")
```

Na Figura X - Gráfico de Louvain - é possível observar as comunidades. 
Cada cor representa uma comunidade detetada pelo algoritmo Louvain, sendo que os nós de cada comunidade estão mais conetados entre si. Por sua vez, os nós mais próximos uns dos outros tendem a ter mais ligações entre si. Os nós mais próximos das fronteiras de cada comunidade são considerados 'nós-pontes' dado facilitarem as interações entre diversas comunidades. 
Desta forma, é possível observar, de forma visual, o que fora abordado até agora, os hubs, os nós centrais e os grupos mais coesos.

Em suma, trata-se de uma rede social relativamente densa e estruturada, com núcleos centrais influentes e uma periferia mais dispersa, permitindo identificar os indivíduos mais centrais e os padrões de ligação predominantes.


**h) Tendo em conta o contexto, identifique algumas características/o papel de alguns dos presentes na festa. Justifique.** 

Pessoas com muitas interações (grau elevado) são os mais sociáveis e/ou populares na festa, servindo como hubs de interação, conectando várias pessoas que, de outra forma, poderiam não interagir, assim como quem pertence ao _28-core_ - núcleo mais interno - desempenha um papel central na coesão do grupo, sendo considerados **'a alma da festa'**.

A _**betweenness**_ mede quantas vezes um nó está no caminho mais curto entre outros dois nós.
Pessoas com _betweenness_ alta são consideradas pontes, intermediários, ligam grupos diferentes, e com _betweeness_ baixa, estão integradas num grupo, mas não ligam grupos entre si.

```{r echo=FALSE, fig.width=6, fig.height=4, fig.cap="Os 10 nós com mais intermediação",fig.pos='H', fig.align='center'}
top10 <- sort(bet, decreasing = TRUE)[1:10]

ids <- names(top10)

barplot(
  top10,
  names.arg = ids,
  col = "orange",
  main = "Top 10 pessoas com maior betweenness",
  ylab = "Betweenness",
  xlab = "Número do Nó"
)
```
Assim, de acordo com a Figura X, o Nodo 30 apresenta a maior _betweenness_ na rede, indicando que atuou como um intermediário crucial entre diferentes grupos na festa, facilitando a comunicação e as interações entre participantes que, de outra forma, estariam menos conectados.

```{r echo=FALSE, fig.width=6, fig.height=4, fig.cap="O nó mais central da Rede da Festa", fig.pos='H', fig.align='center'}
# Criar cores para os nós
cores <- rep("lightblue", vcount(g_festa))
cores[nodo_top] <- "red"  # destaca o nó mais central

# Criar tamanhos proporcionais ao betweenness
tamanhos <- 5 + 10 * (bet / max(bet))  # escala para visualização

# Layout graphopt para espalhar os nós
lay <- layout_with_graphopt(
  g_festa,
  niter = 1000,
  charge = 0.5,
  spring.length = 150)

# Plot da rede
plot(g_festa,
     layout = lay,
     vertex.color = cores,
     vertex.size = tamanhos * 1.3,
     vertex.label = NA,
     edge.color = "grey80",
     vertex.frame.color = "black",
     main = "Nó 30 - O mais central da Rede da Festa")
```

**Participantes periféricos** (de grau baixo e conchas pequenas) têm poucas ligações e podem representar pessoas menos integradas e/ou mais introvertidas, interagindo apenas com pequenos subgrupos.

Já os **núcleos intermediários**, podem ser grupos de amigos próximos ou cliques, que interagem entre si e, em alguns casos, ligam-se ao núcleo central.

Nodos com **clustering local** elevado - indivíduos cujos vizinhos estão muito conectados entre si - podem desempenhar o papel de 'intermediadores', mantendo pequenas “bolhas” de interação dentro da festa vivas.

O **nodo** com o maior grau é considerado o mais social devido ao elevado número de interações, podendo ter o papel de organizador da festa ou - se tal for o caso - o aniversariante.


# Parte II - Q1


### Contextualização

Foi nos pedida a criação de uma rede aleatória através do *Igraph*, usando o modelo _Preferential Attachment_ (PA) na qual devem existir **500 nodos** e cerca de **1000 ligações**. 
Este modelo, que gera uma componente gigante que integra a maioria dos nodos, reflete a estrutura de muitas redes reais, como redes sociais.

Para tal, gerou-se a rede através da função `sample_pa(n = 500, m = 2, directed = FALSE)`. O paramêmtro `n = 500` para os 500 nodos ; No modelo PA, cada novo nó, **n** liga-se a **m** nós já existentes. Como o número total de arestas aproximado é: arestas = n * m, então `m = 2` ; `directed = FALSE` dado que a rede é não direcionada.

```{r fig.width=6, fig.height=6, echo=FALSE, fig.cap = 'Rede Aleatória Q1, gerada pelo Modelo Preferential Attachment', fig.pos='H'}

plot(rede_q1, vertex.size = 5, vertex.label = NA, edge.color = "grey")

```

**I) Detemine a densidade e classifique a rede;**

A densidade da rede gerada pelo modelo PA criada é de **`r round(densidade_pa, 3)`**, isto é, dentro desta rede apenas existem **`r round(densidade_pa * 100, 3)`%** das ligações possíveis.

Como a densidade da rede é muito próxima de 0, a rede é classificada como **rede esparsa**. 

Esta baixa densidade é típica de redes geradas por modelos de crescimento preferencial, dado que poucos nodos acumulam muitas ligações enquanto a maioria permanece pouco conectada, resultando numa estrutura global muito esparsa.

**II) Indique se a rede é conexa;**

Uma rede é conexa se, a partir de qualquer nodo na rede, seja possível alcançar qualquer outro nodo da rede - através das suas ligações. Este facto verifica-se para a rede criada, através do comando `is_connected(rede_q1)`, o que retornou `TRUE`, logo a rede é conexa.

**III) Obtenha o grau médio e a distribuição de grau. Caracterize a distribuição de grau (mediana, quartis, etc.) e comente;**

O grau médio da rede é de **`r round(mean(graus_q1), 2)`**, ou seja, em média cada nodo possui cerca de **`r round(mean(graus_q1), 0)`** ligações.

A distribuição de grau mostra valores entre **`r min(graus_q1)`** e **`r max(graus_q1)`**, com quartis **Q1=`r quantile(graus_q1, probs = 0.25)`**, **Q2(Mediana)=`r median(graus_q1)`** e **Q3=`r quantile(graus_q1, probs = 0.75)`**, o que indica que a maioria dos nodos possui entre `r round(quantile(graus_q1, probs = 0.25))` e `r round(quantile(graus_q1, probs = 0.75))` ligações. Os quartis permitem observar a dispersão dos graus, evidenciando a heterogeneidade típica do modelo Preferential Attachment. 

As estatísticas descritivas mostram que a mediana do grau é menor que a média, refletindo que a maioria dos nodos possui poucas ligações, enquanto alguns nodos (hubs) apresentam um número elevado de ligações.

```{r fig.width=6, fig.height=4, echo=FALSE, fig.cap = 'Distribuição Acumulada de Grau'}

plot(cdf, main = "Distribuição acumulada de grau",
     xlab = "Grau", ylab = "Fração de nodos ≤ k",
     verticals = TRUE, do.points = FALSE)
```

A Figura X confirma que a rede apresenta muitos nodos com baixo grau e poucos nodos altamente conectados.

Esta distribuição de grau é característica do modelo **PA** e é importante para compreender a presença de hubs e as potenciais influências e propagação de informação dentro da rede.

**IV) Calcule o parâmetro de heterogeneidade. Indique o que pode concluir quanto à existência de hubs;**

O parâmetro de heterogeneidade, calculado através da divisão do grau quadrado médio (`grau2_medio`) pelo grau médio ao quadrado (`grau_medio^2`), mede o quão desigual é a distribuição de graus da rede. Para a rede gerada, o valor obtido foi de **`r round(H, 3)`**.

Como este valor é superior a 1, indica que a rede é **heterogénea**, ou seja, existe uma grande variação no número de ligações entre os nodos. Sendo que o número é relativamente elevado, podemos ainda concluir que há a existência de hubs.

Assim, A maioria dos nodos apresenta poucos contactos, enquanto um pequeno número de nodos concentra um número muito elevado de ligações, característica do modelo de *preferential attachment*, onde nós mais antigos tendem a acumular mais ligações ao longo do tempo.

Na figura X, podemos observar os nodos com número de ligações acima do 3o Quartil, que consideramos os **hubs** da rede

```{r fig.width=8, fig.height=6, echo=FALSE, fig.cap = 'Nodos acima de 3o Quartil', fig.pos='H'}
layout <- layout_with_fr(rede_q1, niter = 2000)
vertex_sizes <- pmin(graus_q1 + 2, 6)  # limita tamanho máximo
plot(rede_q1, layout = layout,
     vertex.size = vertex_sizes,
     vertex.color = ifelse(graus_q1 > quantile(graus_q1, 0.75), "red", "skyblue"),
     vertex.label = NA,
     edge.color = "grey",
     margin = 0,
     main="Nodos acima do 3o Quartil")

```

**V) Estude a associação de grau e indique o que poderá concluir-se;**

A associação de grau avalia se nodos com muitas ligações tendem a ligar-se a outros nodos também com várias ligações (rede assortativa) ou se, pelo contrário, se ligam a nodos com poucas ligações (rede desassortativa).

A associação de grau foi calculada, através da função `assortativity_degree(rede_q1, directed=FALSE)` tendo sido obtido o valor de **`r round(assor, 3)`**.

Como o valor é **negativo**, conclui-se que a rede é **desassortativa**, significando que os nodos com grau mais elevado tendem a ligar-se a nodos com grau mais baixo, enquanto a maioria destes últimos não se conecta preferencialmente entre si, como se pode comprovar pela tendência negativa da figura X.

```{r echo=FALSE, fig.width=6, fig.height=4, fig.cap="Grau do nó vs Grau médio dos vizinhos rede Q1", fig.pos='H'}

# Gráfico
plot(graus_q1,
     knn_vals_q1, 
     pch=19,
     cex=1.2,              # tamanho dos pontos
     col=rgb(0,0,1,0.6),   # azul
     xlab="Grau do nodo", 
     ylab="Grau médio dos vizinhos",
     main="Grau do nodo vs Grau médio dos vizinhos")

abline(lm(knn_vals_q1 ~ graus_q1), col="red", lwd=2)

legend("topright", legend="Regressão Linear", col="red", lwd=2, bty="n")
grid()
```
Este comportamento é típico de redes geradas pelo modelo de *preferential attachment*, nas quais existem alguns nós altamente conectados (hubs) que funcionam como pontos centrais de ligação para muitos nós periféricos com poucas ligações. A disassortatividade sugere que a rede é eficiente na conectividade geral e espalha de informação, mas também que os hubs são pontos críticos cuja falha pode fragmentar a rede.

**VI) Determine a média dos comprimentos dos caminhos mais curtos e o diâmetro da rede. Indique o que pode concluir-se quanto à distância média;**

Calculou-se o comprimento médio dos caminhos mais curtos usando a função `mean_distance()` obtendo-se um valor de **`r round(avg_path, 3)`**, enquanto o diâmetro da rede foi de **`r diam`**. Como visto anteriormente, a rede é conexa, logo o diâmetro é calculado sobre a rede inteira. Caso não fosse, era preciso calcular a componente gigante e consequentemente, o seu diâmetro. 

Em média, são necessários cerca de **`r round(avg_path, 2)`** passos para ligar dois nodos da rede. Estes resultados indicam um comportamento de _small-world_. Apesar do grande número de nodos, qualquer par de nodos está separado por um pequeno número de passos, devido à presença de _hubs_ - caraterística do modelo PA. O diâmetro indica o maior caminho dos caminhos mais curtos, e confirma que mesmo os nodos mais distantes estão separados por um número reduzido de passos, ilustrado na Figura abaixo.

```{r echo=FALSE, fig.width=9, fig.height=6, fig.cap="Diâmetro da Rede Q1", fig.pos='H'}
# Encontrar os dois nodos que definem o diâmetro e o caminho entre eles
dia_path <- get_diameter(rede_q1, directed = FALSE)

# criar estilos de nodos
vertex_colors <- rep("#D3D3D350", vcount(rede_q1))
vertex_sizes  <- rep(4, vcount(rede_q1))

# destacar nodos do diâmetro
vertex_colors[dia_path] <- "red"
vertex_sizes[dia_path]  <- 10

# criar estilos de arestas
edge_colors <- rep("#00000020", ecount(rede_q1))
edge_widths <- rep(0.5, ecount(rede_q1))

# destacar arestas do diâmetro
dia_edges <- E(rede_q1, path = dia_path)
edge_colors[dia_edges] <- "orange"
edge_widths[dia_edges] <- 3

# 4) Layout estável
layout <- layout_with_fr(rede_q1)

# 5) Plot final
plot(
  rede_q1,
  layout = layout,
  vertex.color = vertex_colors,
  vertex.size = vertex_sizes,
  vertex.label = NA,
  edge.color = edge_colors,
  edge.width = edge_widths,
  main = paste("Caminho do Diâmetro da Rede (", diam, " passagens)", sep = "")
)
```

Assim, conclui-se que a rede apresenta uma elevada eficiência em termos de conectividade, o que por si só mostra características típicas de redes do tipo **small-world**.

**VII) Determine os coeficientes de clustering da rede. Diga o que pode concluir-se quanto à existência de triângulos.**

O coeficiente de _clustering_ indica a tendência dos nodos da rede formarem triângulos, ou seja, situações em que dois nodos ligados a um terceiro também estão ligados entre si.

Os coeficientes - local e global - da rede foram calculados através da função `transitivity()`, tendo sido obtido o valor de clustering médio de **`r round(clust_media, 3)`**.

Também se realizou a contagem direta de triângulos, em percentagem, o que retornou o valor de **`r round(pct_with_triangles, 2)`**%.

Com base nos valores baixos de transitividade obtidos, inferimos que os triângulos são pouco frequentes na rede. Os vizinhos de um nodo têm **baixa tendência** a estar ligados entre si.
Este padrão é coerente com o modelo PA, que tende a gerar redes com _hubs_, reduzindo a formação de triângulos. 

Assim, a rede Q1 favorece caminhos curtos através de _hubs_, no entanto, impede a formação de comunidades interligadas. 
Em termos práticos, influenciar-se-ia processos de redundância de informação como, por exemplo, informação que poderá propagar-se rapidamente via _hubs_ mas sem redundância local garantida por triângulos, ou seja, como os vizinhos de um _hub_ não estão muito ligados entre si, se uma aresta falha, a informação perde um possível caminho alternativo e a transmissão fica mais dependente dos _hubs_.
Logo, concluímos que a informação chega rapidamente a muitas partes da rede, devido aos hubs, mas não existem pequenos ciclos (triângulos) que reforcem a conetividade local.


# Parte II - Q2


**I) Indique o número de ligações removidas;**

Alteramos a rede obtida em Q1, atribuindo uma probabilidade de **0,1** (prob_rem <- 0.1 )  a cada uma das ligações desta ser removida, escolhendo as ligações a ser removidas usando esta função `runif(ecount(rede_q1)) < prob_rem`.
Após a escolha das ligações selecionadas aleatóriamente pudémos verificar uma redução de **`r rem_nod`** na nova rede.
De seguida, removemos as ligações escolhidas usando `delete_edges(rede_q1, nod_rem)` 

**II) Determine a densidade e classifique a rede;**

A densidade da nova rede criada é de **`r round(densidade_q2, 3)`**, ou seja, dentro da nova rede apenas existem **`r round(densidade_q2 * 100, 3)`%** das ligações possíveis.

A nova rede é também **muito esparsa** e sendo ainda mais esparsa do que a original porque o valor da densidade aproxima-se ainda mais de 0.

**III) Indique se a rede é conexa;**

Devido à remoção dos nodos e consequentemente a perda de **`r rem_nod`** ligações, a nova rede deixou de ser conexa, pois pelo menos um nodo perdeu todas a ligações ficando isolado da rede, como mostrou o comando `is_connected(rede_q2)` que devolveu **FALSE**.

**IV) Obtenha o grau médio e a distribuição de grau. Caracterize a distribuição de grau (mediana, quartis, etc.) e comente;**

O grau médio da rede é de **`r round(mean(graus_q2), 2)`**, ou seja, em média cada nodo possui cerca de **`r round(mean(graus_q2), 0)`** ligações.

-   **Grau Médio**: `r round(mean(graus_q2), 2)`
-   **Mediana** : `r median(graus_q2)`
-   **Mínimo** : `r min(graus_q2)`
-   **Máximo** : `r max(graus_q2)`
-   **1º Quartil** : `r quantile(graus_q2,0.25)`
-   **3º Quartil** : `r quantile(graus_q2,0.75)`

```{r echo=FALSE, fig.width=6, fig.height=3.5, fig.cap="Boxplot da distribuição de graus na Nova Rede", fig.pos='H'}

# Reduz margens
par(mar = c(5, 4, 4, 2) + 0.1)

boxplot(graus_q2,
        horizontal = TRUE,
        col = "lightblue",
        border = "darkblue",
        main = "Boxplot da Distribuição de Graus na Nova Rede",
        xlab = "Número de Interações",
        ylab = "",
        las = 1,
        outcol = "red")

abline(v = median(graus_q2), col = "red", lwd = 2, lty = 2)

legend("topright", legend = paste("Mediana =", median(graus_q2)),
       col = "red", lwd = 2, lty = 2, bty = "n")

grid(nx = NULL, ny = NA, col = "gray90", lty = "dotted")
```

Como é possivél observar na figura 9 a distribuição é bastante assimétrica à direita, o
que indica que a grande maioria dos nodes tem poucas ligações.

```{r echo=FALSE, fig.width=6, fig.height=4, fig.cap="Distribuição dos graus", fig.pos='H', fig.align='center'}

par(mfrow = c(1, 2), oma = c(0, 0, 3, 0)) 

hist(graus_q2, breaks = "FD", col = "skyblue",
     xlim = c(0, 10),
     main = "Entre 0 e 10",
     xlab = " Grau (Número de Interações)",
     ylab = "Frequência")

abline(v = mean(graus_q2), col = "red", lwd = 2)
abline(v = median(graus_q2), col = "blue", lwd = 2)


legend("topright", legend = c("Média", "Mediana"), col = c("red", "blue"), lwd = 2,
       bg = "white")

hist(graus_q2[graus_q2 > 10], breaks = "FD", col = "lightgreen",
     main = "Cauda (Grau > 10)",
     xlab = "Grau",
     ylab = "Frequência")

par(mfrow = c(1, 1))

mtext("Distribuição de Grau da Nova Rede", outer = TRUE, cex = 1.8)
```
Apesar de haver nodos com graus bastante elevados em comparação com a mediana, o valor da média é mais aproximado da mediana pelo motivo de haver uma quantidade muito mais elevada de nodos com gruas perto do valor da mediana do que nodos com valores elevados.


**V) Calcule o parâmetro de heterogeneidade. Indique o que pode concluir quanto à existência de hubs;**

O parâmetro de heterogeneidade calculado foi de **`r H_q2`**.

Como este valor continua superior a 1, então a nova rede mantem-se heterogénea, ou seja, continua a existir uma grande variação no número de ligações entre os nodos. Sendo que o número que permanece é relativamente elevado, podemos ainda concluir que existem, muito provavelmente, os mesmos hubs.

**VI) Estude a associação de grau e indique o que poderá concluir-se;**

A associação de grau foi novamente calculada, através da função `assortativity_degree(rede_q2, directed=FALSE)` tendo sido obtido o valor de `r assor_q2`.

O valor fica novamente **negativo**, concluindo que a rede continua **desassortativa**, o que já era de se esperar, porque ao remover ligações numa rede, seria estranho a rede tornar se assortativa. enquanto a maioria destes últimos não se conecta
preferencialmente entre si, como se pode comprovar pela tendência negativa da figura X.


**VII) Determine a média dos comprimentos dos caminhos mais curtos e o diâmetro da rede. Indique o que pode concluir-se quanto à distância média;**

 Novamente calculou-se o comprimento médio dos caminhos mais curtos usando a função `mean_distance(rede_q2, directed = FALSE)` obtendo-se um valor de **`r round(avg_path_q2, 3)`**, enquanto o diâmetro da rede foi de **`r diam_q2`**. A nova rede - como referido anteriormente - não é conexa. Desta forma, o seu diâmetro é equivalente ao diâmetro da componente gigante, cálculo este que é efetuado automaticamente pelo pacote _igraph_.
 
```{r echo=FALSE, fig.width=9, fig.height=6, fig.cap="Diâmetro da Rede Q1", fig.pos='H'}
# Encontrar os dois nodos que definem o diâmetro e o caminho entre eles
dia_path <- get_diameter(rede_q2, directed = FALSE)

# criar estilos de nodos
vertex_colors <- rep("#D3D3D350", vcount(rede_q2))
vertex_sizes  <- rep(4, vcount(rede_q2))

# destacar nodos do diâmetro
vertex_colors[dia_path] <- "red"
vertex_sizes[dia_path]  <- 10

# criar estilos de arestas
edge_colors <- rep("#00000020", ecount(rede_q2))
edge_widths <- rep(0.5, ecount(rede_q2))

# destacar arestas do diâmetro
dia_edges <- E(rede_q2, path = dia_path)
edge_colors[dia_edges] <- "orange"
edge_widths[dia_edges] <- 3

# 4) Layout estável
layout <- layout_with_fr(rede_q2)

# 5) Plot final
plot(
  rede_q2,
  layout = layout,
  vertex.color = vertex_colors,
  vertex.size = vertex_sizes,
  vertex.label = NA,
  edge.color = edge_colors,
  edge.width = edge_widths,
  main = paste("Caminho do Diâmetro da Rede (", diam, " passagens)", sep = "")
)
```
Na figura X, é possivel observar o maior caminho dos caminhos mais curtos (diâmetro).

**VIII) Determine o coeficiente de clustering da rede. Diga o que pode concluir-se quanto à existência de triângulos;**

Os coeficientes - local e global - da nova rede foram calculados através da função `transitivity(rede_q2, type = "global")`, tendo sido obtido o valor de clustering médio de **`r clust_global_q2`**.

Realizou se novamente a contagem direta de triângulos, em percentagem, o que retornou o valor de **`r pct_with_triangles_q2`**.

A nova rede cria percursos curtos graças aos hubs, mas dificulta a formação de comunidades ligadas entre si. A informação propaga-se rapidamente através dos hubs, porém sem redundância local: como os vizinhos dos hubs quase não se ligam entre si, a falha de uma aresta pode quebrar caminhos alternativos. Assim, a rede é rápida a difundir informação, mas carece de pequenos ciclos que reforcem a conectividade local.

**IX)  Compare os resultados obtidos antes e após a remoção de ligações.**


